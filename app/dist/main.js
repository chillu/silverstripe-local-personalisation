!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){var i=n(2),r=n(3);t.exports=function(t,e,n){var o=e&&n||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var a=(t=t||{}).random||(t.rng||i)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e)for(var s=0;s<16;++s)e[o+s]=a[s];return e||r(a)}},function(t,e,n){n(6),t.exports=n(5)},function(t,e){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);t.exports=function(){return n(i),i}}else{var r=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),r[e]=t>>>((3&e)<<3)&255;return r}}},function(t,e){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);t.exports=function(t,e){var i=e||0,r=n;return[r[t[i++]],r[t[i++]],r[t[i++]],r[t[i++]],"-",r[t[i++]],r[t[i++]],"-",r[t[i++]],r[t[i++]],"-",r[t[i++]],r[t[i++]],"-",r[t[i++]],r[t[i++]],r[t[i++]],r[t[i++]],r[t[i++]],r[t[i++]]].join("")}},function(t,e,n){},function(t,e,n){},function(t,e,n){"use strict";n.r(e);var i,r=n(0);function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var s=function(){function t(e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,"data",void 0),a(this,"ruleset",void 0),a(this,"points",void 0),a(this,"sortedPoints",void 0),a(this,"version",void 0),a(this,"clickRules",void 0),a(this,"timeRules",void 0),a(this,"myPosition",void 0),this.ruleset=e,this.points=n,this.version=i||1,this.clickRules={}}var e,n,i;return e=t,(n=[{key:"evaluateRequest",value:function(){var t=this;this.checkRules(),this.checkContent(),this.points.length>0&&navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(e){if(e.coords){for(var n=e.coords.latitude,i=e.coords.longitude,r=[],o=0;o<t.points.length;o++){var a=t.points[o];a.distance=t.distance(n,i,a.lat,a.lon),r.push(a)}t.sortedPoints=r.sort((function(t,e){return t.distance<e.distance?-1:t.distance==e.distance?0:1})),t.checkLocation()}})),setTimeout((function(){console.log("Profile.js: checking 3s rules"),t.checkRules(3),t.checkContent()}),3e3),setTimeout((function(){console.log("Profile.js: checking 10s rules"),t.checkRules(10),t.checkContent()}),1e4),setTimeout((function(){console.log("Profile.js: checking 30s rules"),t.checkRules(30),t.checkContent()}),3e4),setTimeout((function(){console.log("Profile.js: checking 120s rules"),t.checkRules(120),t.checkContent()}),12e4)}},{key:"checkRules",value:function(t){for(var e=!1,n=0;n<this.ruleset.length;n++){var i=this.ruleset[n],r=parseInt(i.time);if(!(t&&r!=t||!t&&r)){var o=!1;if("click"===i.event&&i.target?this.clickRules[i.target]=n:i.selector?o=this.isCssMatch(i):i.regex&&(o=this.isMatch(i)),o){e=!0;var a=this.extractData(i);a&&a.length>0&&(console.log("Profile.js: apply from page match",a),this.applyRule(i,a))}}}e&&this.save(),!t&&Object.keys(this.clickRules).length>0&&this.bindClickEvents()}},{key:"checkLocation",value:function(){for(var t=!1,e=0;e<this.ruleset.length;e++){var n=this.ruleset[e],i=!1;if("location"==n.appliesTo&&(i=this.nearestPoint(n)),i){t=!0;var r=this.extractData(n);r&&r.length>0&&(console.log("Profile.js: apply from location match",r),this.applyRule(n,r))}}t&&this.save()}},{key:"checkContent",value:function(){var t=document.getElementsByClassName("lp-item"),e=this.data.tags;if(t)for(var n=function(t,n,i){if(t&&t.length>0){for(var r=[],o="+"===t[0],a=t.replace("+","").replace(" ","").split(","),s=0;s<a.length;s++)if(!(a[s].length<=0)){var l="!"==a[s][0],c=a[s].replace("!","");if(!(!e[c]&&!l||e[c]&&l)){console.log("Profile.Js: "+a[s]+" matched profile");var u=e[c],h=[];if(i>0&&u?function(){var t=1e3*i;h=u.acc.filter((function(e){return e.t>t}))}():h=u?u.acc:[],n>1&&n>(h||[]).length)break;r.push(a[s])}}return(o?r.length==a.length:r.length>0)?r:null}},i=0;i<t.length;i++){var r=t[i],o=[r.getAttribute("data-lp-show-tags"),r.getAttribute("data-lp-show-times")||1,r.getAttribute("data-lp-show-timeblock")||0],a=[r.getAttribute("data-lp-hide-tags"),r.getAttribute("data-lp-hide-times")||1,r.getAttribute("data-lp-hide-timeblock")||0],s=n.apply(this,o),l=n.apply(this,a);if(s||l){var c="show";r.hasAttribute("data-lp-prefer")&&(c=r.getAttribute("data-lp-prefer"));var u={matchType:c,showMatches:s,hideMatches:l};console.log("Profile.js: Trigger local_profile_match_tag",u),this.triggerEvent("local_profile_match_tag",u),"show"===c&&s?(r.classList.remove("lp-hide"),r.classList.add("lp-show")):"hide"===c&&l?(r.classList.remove("lp-show"),r.classList.add("lp-hide")):s?(r.classList.remove("lp-hide"),r.classList.add("lp-show")):l&&(r.classList.remove("lp-show"),r.classList.add("lp-hide"))}}}},{key:"bindClickEvents",value:function(){var t=this;document.addEventListener("click",(function(e){var n=!1;for(var i in t.clickRules){var r=e.target;if(r.matches(i)){var o=t.clickRules[i],a=t.ruleset[o],s=!0;if(a.selector?s=t.isCssMatch(a):a.regex&&(s=t.isMatch(a)),s){var l=t.extractData(a);l?(l.push(r.getAttribute("href")),l.push(r.innerHTML)):l=[r.getAttribute("href"),r.innerHTML],l&&l.length>0&&(console.log("Profile.js: apply from event match",l),t.applyRule(a,l),n=!0)}}}n&&t.save()}))}},{key:"extractData",value:function(t){var e=t.extractor,n=[];if(e.selector&&e.attribute)document.querySelectorAll(e.selector).forEach((function(t){"#content"===e.attribute?n.push(t.innerHTML):n.push(t.getAttribute(e.attribute))}));else if(e.regex){var i=this.getContentFor(e);n=new RegExp(t.regex).exec(i)}else if("location"==e.appliesTo){var r=this.nearestPoint(e);n.push(r.title)}else"none"==e.appliesTo&&n.push(document.title);return n}},{key:"getContentFor",value:function(t){var e=null;return"url"==t.appliesTo?e=location.href:"referrer"==t.appliesTo?e=document.referrer:"content"==t.appliesTo||"click"==t.appliesTo?e=document.querySelector("body").innerHTML:"useragent"==t.appliesTo&&(e=navigator.userAgent),e}},{key:"nearestPoint",value:function(t){if(this.points&&this.points.length>0){if(t.matchnearest)return this.points[0];if(!t.maxdistance)return;for(var e=0;e<this.points.length;e++)if(this.points[e].distance<t.maxdistance)return this.points[e]}else console.warn("Profile.js: No position information available to check location rules")}},{key:"isMatch",value:function(t){var e=this.getContentFor(t),n=new RegExp(t.regex).exec(e);return n&&n.length>0}},{key:"isCssMatch",value:function(t){if(t.selector)return document.querySelectorAll(t.selector).length>0}},{key:"applyRule",value:function(t,e){var n=this;if(t.apply&&t.apply.length>0){this.triggerEvent("local_profile_apply_rule",t);for(var i=function(i){var r=t.apply[i];r.indexOf("$")>=0&&e&&e.length>0&&e.forEach((function(t,e){r=(r=r.replace("$"+e,t))?r.trim():""})),n.addTag(r)},r=0;r<t.apply.length;r++)i(r)}}},{key:"addTag",value:function(t){var e=t.replace(/[^A-Za-z0-9_-]/g,"-").toLowerCase();this.data.tags||(this.data.tags={});var n=this.data.tags[e];for(n||(n={acc:[]});n.acc.length>=10;)n.acc.pop();var i={t:(new Date).getTime(),u:location.href,r:t};this.triggerEvent("local_profile_add_tag",i),n.acc.unshift(i),this.data.tags[e]=n}},{key:"findOldestTag",value:function(){var t=null,e=null;for(var n in(new Date).getTime(),this.data.tags){var i=this.data.tags[n];if(!i.acc||0===i.acc.length)return n;var r=i.acc[i.acc.length-1];(!e||e>r.t)&&(e=r.t,t=n)}return t}},{key:"loadFromStore",value:function(){var t=localStorage.getItem("lp_user_state");if(t&&t.length>0){var e=JSON.parse(t);if(e&&e.uid&&e.version&&e.version==this.versionString())return this.data=e,!0}return!1}},{key:"writeToStore",value:function(){if(this.data||(this.data={version:this.versionString(),uid:r(),tags:{}}),Object.keys(this.data.tags).length>50){var t=this.findOldestTag();t&&delete this.data.tags[t]}localStorage.setItem("lp_user_state",JSON.stringify(this.data))}},{key:"versionString",value:function(){return"2."+this.version}},{key:"save",value:function(){this.writeToStore()}},{key:"triggerEvent",value:function(t,e,n){n||(n=document);var i=new CustomEvent(t,e?{detail:e}:null);n.dispatchEvent(i)}},{key:"distance",value:function(t,e,n,i,r){if(r||(r="K"),t==n&&e==i)return 0;var o=Math.PI*t/180,a=Math.PI*n/180,s=e-i,l=Math.PI*s/180,c=Math.sin(o)*Math.sin(a)+Math.cos(o)*Math.cos(a)*Math.cos(l);return c>1&&(c=1),c=60*(c=180*(c=Math.acos(c))/Math.PI)*1.1515,"K"==r&&(c*=1.609344),"N"==r&&(c*=.8684),c}}])&&o(e.prototype,n),i&&o(e,i),t}();!function(){if(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),"function"==typeof window.CustomEvent)return!1;function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}t.prototype=window.Event.prototype,window.CustomEvent=t}();var l,c,u;n(4);if(window.PERSONSALISATION_RULESET){var h=(l=window.PERSONSALISATION_RULESET.rules,c=window.PERSONSALISATION_RULESET.points,u=window.PERSONSALISATION_RULESET.version,(i=new s(l,c,u)).loadFromStore()||i.writeToStore(),i);h.evaluateRequest(),window.DEBUG_SHOW_PROFILE=function(){console.log(h.data)}}else console.warn("Profile.js: PERSONSALISATION_RULESET not found")}]);